# i3 Config File:
#   location: ~/.config/i3/config
#   author: t3@pfaffe.me  2020-2020
#   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#   Please see https://i3wm.org/docs/userguide.html for a complete reference.
#   Heavy modification from Manjaro's default i3-config:
#    https://gitlab.manjaro.org/profiles-and-settings/desktop-settings/-/blob/master/community/i3/skel/.i3/config


#Set mod-key
set $mod Mod4

#Set default desktop layout (default is tiling)
# workspace_layout tabbed <stacking|tabbed>

#Use Mouse+$mod to drag floating windows
floating_modifier $mod


###############
## STARTUP #############################################################
###############

##Set Display Configuration
exec_always autorandr -c && sleep 50ms &&  nitrogen --restore


##Startup Critical WM Daemons
#################################
#Compositor
set $exec_picom picom -b --experimental-backend
exec_always pkill picom; $exec_picom

#Screensaver/Lock
set $lockScript "betterlockscreen -l blur"
exec --no-startup-id betterlockscreen -w blur
exec --no-startup-id xautolock -time 10 -secure -detectsleep -locker $lockScript

#Startup Notification Daemon
exec_always systemctl start --user dunst.service
#################################

##Startup Critical WM Applets
exec --no-startup-id nm-applet
exec --no-startup-id pa-applet
exec --no-startup-id blueman-applet

##Startup Non-Critical System Daemon
exec --no-startup-id aarchup -p /usr/share/aarchup/archlogo.png --loop-time 360
exec --no-startup-id albert
#exec --no-startup-id onedrive --monitor
#     ondrive already  setup with Systemd

##Startup Non-Critical System Applets
exec --no-startup-id kdeconnect-indicator
exec --no-startup-id nextcloud --background


###################
## APP-KEYBINDS ############################################################
###################

##Application-Launchers
	bindsym $mod+Return exec termite
	bindsym $mod+Shift+Return exec io.elementary.terminal -n
	bindsym $mod+F2 exec firefox
	bindsym $mod+Shift+F2 exec brave
	bindsym $mod+F3 exec nemo
	bindsym $mod+P  exec spectacle
	bindsym $mod+Shift+End exec spotify
	bindsym $mod+Shift+M exec protonmail-bridge --no-window & sleep 5s && exec evolution
##

##WM Daemon Control Keybinds
	bindsym $mod+Shift+n --release exec "killall dunst;exec dunst; exec notify-send 'restart dunst'"
	#bindsym $mod+t                 exec --no-startup-id pkill picom
	#bindsym $mod+Ctrl+t            exec pkill picom && exec $exec_picom

#Kill focused window
	bindsym $mod+Shift+q kill

#Launch program launcher (dmenu)
	bindsym $mod+d exec --no-startup-id rofi -show drun
	bindsym $mod+Shift+d exec --no-startup-id rofi -show run
	bindsym $mod+s exec --no-startup-id albert show

#Launch categorized menu
	#bindsym $mod+z exec --no-startup-id morc_menu

##Monitor Brightness Controls:
	bindsym XF86MonBrightnessUp   exec light -A 5 && exec notify-send -t 500 "Brightness: $(light -G)"
	bindsym XF86MonBrightnessDown exec light -U 5 && exec notify-send -t 500 "Brightness: $(light -G)"

##Audio Volume Controls:
	set $refresh_i3status killall -SIGUSR1 i3status
	bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +10%
	bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -10%
	bindsym XF86AudioMute exec --no-startup-id pactl set-sink-mute @DEFAULT_SINK@ toggle
	bindsym XF86AudioMicMute exec --no-startup-id pactl set-source-mute @DEFAULT_SOURCE@ toggle
##

##Media Controls
	bindsym Prior exec "playerctl --player=spotify,%any previous"
	bindsym Next  exec "playerctl --player=spotify,%any next"
	bindsym End   exec "playerctl --player=spotify,%any play-pause"
	bindsym XF86AudioPrev  exec "playerctl --player=spotify,%any previous"
	bindsym XF86AudioNext  exec "playerctl --player=spotify,%any next"
	bindsym XF86AudioPlay  exec "playerctl --player=spotify,%any play-pause"
##

##Screenshotting
	bindsym --release Print exec spectacle -c
	bindsym --release $mod+Shift+Print exec "spectacle --region"

##Logout/Exit i3 & Xsession
	bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -B 'Yes, exit i3' 'i3-msg exit'"
	bindsym $mod+Ctrl+Shift+e --release exec i3-msg exit

##Lock screen
	bindsym $mod+l exec --no-startup-id $lockScript
	#bindsym $mod+9 exec --no-startup-id $lockScript

#Reload the configuration file
bindsym $mod+Shift+c reload

#Restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart

##Set shut down, restart and locking features:
#############################################
bindsym $mod+0 mode "$mode_system"
set $mode_system (l)ock, (e)xit, switch_(u)ser, (s)uspend, (h)ibernate, (r)eboot, (Shift+s)hutdown
mode "$mode_system" {
    bindsym l exec --no-startup-id i3exit lock, mode "default"
    bindsym s exec --no-startup-id i3exit suspend, mode "default"
    bindsym u exec --no-startup-id i3exit switch_user, mode "default"
    bindsym e exec --no-startup-id i3exit logout, mode "default"
    bindsym h exec --no-startup-id i3exit hibernate, mode "default"
    bindsym r exec --no-startup-id i3exit reboot, mode "default"
    bindsym Shift+s exec --no-startup-id i3exit shutdown, mode "default"

    # exit system mode: "Enter" or "Escape"
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
#############################################


##########################
## NAVIGATION-KEYBINDS #####################################################
##########################

##Container Navigation Controls:
###############################

##Change focus
bindsym $mod+semicolon focus right
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right
##

##Change container layout (stacked, tabbed, toggle split)
bindsym $mod+e layout toggle split
bindsym $mod+Shift+t layout toggle tabbed stacking split
# individual h, v, & tabbed controls
bindsym $mod+h split h
bindsym $mod+v split v
bindsym $mod+t layout tabbed
##

##Move focused window in stack
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right
##

#Enter fullscreen mode for the focused container
bindsym $mod+f fullscreen toggle

#Enter Sticky mode for the focused container
bindsym $mod+Shift+s sticky toggle

#Toggle tiling / floating
bindsym $mod+Shift+space floating toggle

#Change focus between tiling / floating windows
bindsym $mod+space focus mode_toggle

#Focus the parent container
bindsym $mod+a focus parent

#Focus the child container
bindsym $mod+z focus child

##Resize window:
###############

bindsym $mod+Alt_L+Left  resize shrink width 10 px or 10 ppt
bindsym $mod+Alt_L+Down  resize grow height 10 px or 10 ppt
bindsym $mod+Alt_L+Up    resize shrink height 10 px or 10 ppt
bindsym $mod+Alt_L+Right resize grow width 10 px or 10 ppt

#resize mode
mode "resize" {
        # These bindings trigger as soon as you enter the resize mode

        # Pressing left will shrink the window‚Äôs width.
        # Pressing right will grow the window‚Äôs width.
        # Pressing up will shrink the window‚Äôs height.
        # Pressing down will grow the window‚Äôs height.
        bindsym j resize shrink width 10 px or 10 ppt
        bindsym k resize grow height 10 px or 10 ppt
        bindsym l resize shrink height 10 px or 10 ppt
        bindsym semicolon resize grow width 10 px or 10 ppt

        # same bindings, but for the arrow keys
        bindsym Left resize shrink width 10 px or 10 ppt
        bindsym Down resize grow height 10 px or 10 ppt
        bindsym Up resize shrink height 10 px or 10 ppt
        bindsym Right resize grow width 10 px or 10 ppt

        # back to normal: Enter or Escape or $mod+r
        bindsym Return mode "default"
        bindsym Escape mode "default"
        bindsym $mod+r mode "default"
}

bindsym $mod+r mode "resize"
###############

#Quiet Mode:
# to isloate container with large gaps
######################################
set $quiet (q)uiet_toggle, (s)mall, (m)edium, (l)arge, (esc)ape
mode "$quiet" {
        # These bindings trigger as soon as you enter the resize mode

        # Move a window in and out the quiet mode
        bindsym q exec ~/.config/i3/quiet-cmd.py toggle ; mode "default"

        # Resize the window in quiet mode
        bindsym s exec ~/.config/i3/quiet-cmd.py resize small
        bindsym m exec ~/.config/i3/quiet-cmd.py resize medium
        bindsym l exec ~/.config/i3/quiet-cmd.py resize large

        # back to normal
        bindsym Escape mode "default"
        bindsym Return mode "default"
        bindsym Caps_Lock mode "default"
        bindsym $mod+d mode "default"
}

bindsym $mod+Shift+f mode "$quiet"
######################################
###############################


##Workspace Naviation:
#####################

#Navigate workspaces next / previous
bindsym $mod+Ctrl+Right workspace next
bindsym $mod+Ctrl+Left workspace prev

#Move between container workspaces next / previous
bindsym $mod+Shift+Ctrl+Right move container to workspace next
bindsym $mod+Shift+Ctrl+Left  move container to workspace prev

#Workspace back and forth (with/without active container)
workspace_auto_back_and_forth yes
bindsym $mod+Tab workspace back_and_forth
bindsym $mod+Shift+Tab move container to workspace back_and_forth; workspace back_and_forth

# move the currently focused window to the scratchpad
bindsym $mod+Shift+minus move scratchpad

# Show the next scratchpad window or hide the focused scratchpad window.
# If there are multiple scratchpad windows, this command cycles through them.
bindsym $mod+minus scratchpad show

##Workspace Definitions
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $wsM "0 üéù "
##

##Workspace Binds
set $wsKey1 1
set $wsKey2 2
set $wsKey3 3
set $wsKey4 4
set $wsKey5 5
set $wsKey6 6
set $wsKey7 7
set $wsKey8 8
set $wsKey9 9
set $wsKeyM grave
##

##Switch to workspace (i3Native)
bindsym $mod+Control+$wsKey1 workspace number $ws1
bindsym $mod+Control+$wsKey2 workspace number $ws2
bindsym $mod+Control+$wsKey3 workspace number $ws3
bindsym $mod+Control+$wsKey4 workspace number $ws4
bindsym $mod+Control+$wsKey5 workspace number $ws5
bindsym $mod+Control+$wsKey6 workspace number $ws6
bindsym $mod+Control+$wsKey7 workspace number $ws7
bindsym $mod+Control+$wsKey8 workspace number $ws8
bindsym $mod+Control+$wsKey9 workspace number $ws9
bindsym $mod+Control+$wsKeyM workspace number $wsM
##

##Move focused container to workspace (i3Native)
bindsym $mod+Control+Shift+$wsKey1 move container to workspace $ws1
bindsym $mod+Control+Shift+$wsKey2 move container to workspace $ws2
bindsym $mod+Control+Shift+$wsKey3 move container to workspace $ws3
bindsym $mod+Control+Shift+$wsKey4 move container to workspace $ws4
bindsym $mod+Control+Shift+$wsKey5 move container to workspace $ws5
bindsym $mod+Control+Shift+$wsKey6 move container to workspace $ws6
bindsym $mod+Control+Shift+$wsKey7 move container to workspace $ws7
bindsym $mod+Control+Shift+$wsKey8 move container to workspace $ws8
bindsym $mod+Control+Shift+$wsKey9 move container to workspace $ws9
bindsym $mod+Control+Shift+$wsKeyM move container to workspace $wsM
##
#######################


##Grouped Workspaces Naviation:
##############################

#Set i3_groups command
set $exec_i3_groups exec --no-startup-id i3-workspace-groups

##Switch to workspace
bindsym $mod+$wsKey1 workspace number $ws1
bindsym $mod+$wsKey2 workspace number $ws2
bindsym $mod+$wsKey3 workspace number $ws3
bindsym $mod+$wsKey4 workspace number $ws4
bindsym $mod+$wsKey5 workspace number $ws5
bindsym $mod+$wsKey6 workspace number $ws6
bindsym $mod+$wsKey7 workspace number $ws7
bindsym $mod+$wsKey8 workspace number $ws8
bindsym $mod+$wsKey9 workspace number $ws9
bindsym $mod+$wsKeyM workspace number $wsM
##

##Move focused container to workspace
bindsym $mod+Shift+$wsKey1 move container to workspace number $ws1
bindsym $mod+Shift+$wsKey2 move container to workspace number $ws2
bindsym $mod+Shift+$wsKey3 move container to workspace number $ws3
bindsym $mod+Shift+$wsKey4 move container to workspace number $ws4
bindsym $mod+Shift+$wsKey5 move container to workspace number $ws5
bindsym $mod+Shift+$wsKey6 move container to workspace number $ws6
bindsym $mod+Shift+$wsKey7 move container to workspace number $ws7
bindsym $mod+Shift+$wsKey8 move container to workspace number $ws8
bindsym $mod+Shift+$wsKey9 move container to workspace number $ws9
bindsym $mod+Shift+$wsKeyM move container to workspace number $wsM
##

# Switch active workspace group
bindsym $mod+g exec --no-startup-id i3-switch-active-workspace-group

# Assign workspace to a group
bindsym $mod+Shift+g exec --no-startup-id i3-assign-workspace-to-group

# Select workspace to focus on
bindsym $mod+w exec --no-startup-id i3-focus-on-workspace

# Move the focused container to another workspace
bindsym $mod+Shift+w exec --no-startup-id i3-move-to-workspace

# Rename/renumber workspace. Uses Super+Alt+n
bindsym Mod1+Mod4+n exec --no-startup-id i3-rename-workspace

##############################


#################
### Theming: ###########################################################
#################

##Define Theme Colors
# Primary, Background, Highlight
set $primaC #BF4040
set $backCl #222222
set $highCl #FDF6E3
# Text & Secondary in Dark  Environment (Light to contrast Dark background)
set $txtLCl #F9FAF9
set $secLCl #EEE8D5
# Text in Dark Environment              (Faded-Light on Dark Background)
set $txtFCl #C7C8C7
# Text & Secondary in Light Environment (Dark to contrast Light background)
set $txtDCl #292F34
set $secDCl #454947


## Set Theme colors
# class                   border  backgr. text    indic.   child_border
  client.focused          $secDCl $secDCl $txtLCl #FDF6E3
  client.focused_inactive $secDCl $secDCl $txtFCl #454948
  client.unfocused        $secDCl $backCl $txtFCl #454948
  client.urgent           $secDCl $highCl $txtDCl #268BD2
  client.placeholder      #000000 #0c0c0c #ffffff #000000

  client.background       $backCl
##

##Configure border style <normal|1pixel|pixel xx|none|pixel>
default_border pixel 1
default_floating_border normal

#Hide borders
hide_edge_borders smart

#Change borders
bindsym $mod+u border none
bindsym $mod+y border pixel 1
bindsym $mod+n border normal

##Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below.
font pango:Noto Sans Medium, NotoSans Nerd Font Display Medium 9

# Title Format
#for_window [class=".*"] title_format "%title"

# title_alignment left|center|right
title_align center

# Drawing marks on window decoration
show_marks yes


#################
### Task Bar: ##########################################################
#################

##Start i3bar
bar {
		strip_workspace_numbers yes

		font pango:Noto Sans Mono Medium, NotoSansMono Nerd Font Medium 9
		colors {
			background $backCl
			statusline $txtLCl
			separator  $secDCl

			#                  border  backgr. text
			focused_workspace  $highCl $primaC $txtDCl
			active_workspace   $secDCl $primaC $txtFCl
			inactive_workspace $secDCl $secDCl $txtFCl
			urgent_workspace   $secDCl $highCl $txtDCl
			binding_mode       $primaC $backCl $txtFCl
			#Note: focused is on mouseover, active is open on a display.
		}


		tray_output primary
		tray_padding 0

		position top

    status_command ~/.config/i3/getMediaInfo.sh
}


#############################
### Settings for i3-gaps: ##############################################
#############################

#Set inner/outer gaps
gaps inner  8
gaps outer -2

#Additionally, you can issue commands with the following syntax. This is useful to bind keys to changing the gap size.
# gaps inner|outer current|all set|plus|minus <px>
# gaps inner all set 10
# gaps outer all plus 5

#Smart gaps (gaps used if only more than one container on the workspace)
smart_gaps inverse_outer

#Smart borders (draw borders around container only if it is not the only container on this workspace)
# on|no_gaps (on=always activate and no_gaps=only activate if the gap size to the edge of the screen is 0)
smart_borders on
smart_borders no_gaps

#Quick gap change
bindsym $mod+Shift+bracketright  gaps inner current plus 5
bindsym $mod+Shift+bracketleft   gaps inner current minus 5

bindsym $mod+Ctrl+bracketright  gaps inner current plus 5
bindsym $mod+Ctrl+bracketleft   gaps inner current minus 5

#Press $mod+Shift+g to enter the gap mode. Choose o or i for modifying outer/inner gaps. Press one of + / - (in-/decrement for current workspace) or 0 (remove gaps for current workspace). If you also press Shift with these keys, the change will be global for all workspaces.
set $mode_gaps Gaps: (o) outer, (i) inner
set $mode_gaps_outer Outer Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_inner Inner Gaps: +|-|0 (local), Shift + +|-|0 (global)
bindsym $mod+Shift+bar mode "$mode_gaps"

mode "$mode_gaps" {
        bindsym o      mode "$mode_gaps_outer"
        bindsym i      mode "$mode_gaps_inner"
        bindsym Return mode "default"
        bindsym Escape mode "default"
}
mode "$mode_gaps_inner" {
        bindsym plus  gaps inner current plus 5
        bindsym minus gaps inner current minus 5
        bindsym 0     gaps inner current set 0

        bindsym Shift+plus  gaps inner all plus 5
        bindsym Shift+minus gaps inner all minus 5
        bindsym Shift+0     gaps inner all set 0

        bindsym Return mode "default"
        bindsym Escape mode "default"
}
mode "$mode_gaps_outer" {
        bindsym plus  gaps outer current plus 5
        bindsym minus gaps outer current minus 5
        bindsym 0     gaps outer current set 0

        bindsym Shift+plus  gaps outer all plus 5
        bindsym Shift+minus gaps outer all minus 5
        bindsym Shift+0     gaps outer all set 0

        bindsym Return mode "default"
        bindsym Escape mode "default"
}


#####################################
### Settings for i3-gaps-rounded: ######################################
#####################################

for_window [class=".*"] border pixel 2 #*
border_radius 3

#########################################
### Predefined Application Settings: ###################################
#########################################
# Note: Find a window's details in xorg with the command "xprop"

##Set default monitor assignments
# workspace $ws2 output DP-1-1-1
# workspace $ws3 output eDP-1-1
# workspace $wsM output eDP-1-1

##Set specifica application naming schemes:
for_window [class="Termite"] title_format "Terminal -  %title "


##Open applications on specific workspaces:
##########################################
for_window [class="Spotify"] move to workspace $wsM
for_window [class="Plexamp"] move to workspace $wsM
##########################################

##Open applications in floating mode:
####################################
##Generic roles
for_window [window_role="About"] floating enable
for_window [window_role="Preferences"] floating enable
for_window [window_role="pop-up"] floating enable
for_window [window_role="task_dialog"] floating enable
for_window [window_role="bubble"] floating enable
##

##Generic types
for_window [window_type="dialog"] floating enable
for_window [window_type="menu"] floating enable
for_window [window_type="splash"] floating enable
for_window [window_type="popup_menu"] floating enable
for_window [window_type="notification"] floating enable

##Specific applications
for_window [title="alsamixer"] floating enable border pixel 1
for_window [class="gnome-calculator"] floating enable border pixel 1
for_window [class="spectacle"] floating enable border pixel 1
for_window [class="Gnome-calculator"] floating enable border pixel 1
for_window [class="GParted"] floating enable border normal
for_window [class="Lxappearance"] floating enable sticky enable border normal
for_window [class="Nitrogen"] floating enable sticky enable border normal
for_window [class="Pamac-manager"] floating enable
for_window [class="Pavucontrol"] floating enable
for_window [class="qt5ct"] floating enable sticky enable border normal
for_window [class="Qtconfig-qt4"] floating enable sticky enable border normal
for_window [class="Simple-scan"] floating enable border normal
for_window [class="(?i)System-config-printer.py"] floating enable border normal
for_window [class="Timeset-gui"] floating enable border normal
for_window [class="Font-manager"] floating enable
for_window [class="(?i)virtualbox"] floating enable border normal
##
####################################
